<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Malla Curricular Derecho UCV</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=League+Spartan:700&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700&display=swap" rel="stylesheet" />
  <style>
    body {
      margin: 0;
      background: #114087;
      color: #222;
      min-height: 100vh;
      font-family: 'Montserrat', Arial, sans-serif;
      overflow-x: auto;
      position: relative;
    }
    #btn-regresa {
      position: fixed;
      top: 12px;
      left: 12px;
      background: #ffffff;
      color: #114087;
      border: none;
      border-radius: 8px;
      padding: 10px 16px;
      font-family: 'Montserrat', Arial, sans-serif;
      font-weight: 700;
      font-size: 1em;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
      z-index: 10000;
      user-select: none;
      transition: background-color 0.25s, color 0.25s;
    }
    #btn-regresa:hover, #btn-regresa:focus {
      background: #114087;
      color: #fff;
      outline: none;
    }
    #logo-header {
      position: fixed;
      top: 12px;
      right: 12px;
      max-width: 120px;
      height: auto;
      z-index: 10000;
      user-select: none;
    }
    h1 {
      font-family: 'League Spartan', Arial, sans-serif;
      text-align: center;
      color: #fff;
      font-size: 2.5em;
      margin: 32px 0 20px 0;
      letter-spacing: 2px;
      user-select: none;
      line-height: 1.2;
    }
    /* CONTENEDOR PRINCIPAL: grid 3 columnas x 2 filas en escritorio */
    .main-container {
      max-width: 1280px;
      margin: 0 auto 35px auto;
      padding: 0 10px;
      display: grid;
      grid-template-columns: repeat(3, minmax(250px, 1fr));
      grid-template-rows: auto auto;
      gap: 30px;
    }
    /* COLUMNAS */
    #col-1 {
      grid-column: 1;
      grid-row: 1 / 3; /* ocupa dos filas */
      display: flex;
      flex-direction: column;
      gap: 30px;
    }
    #col-2 {
      grid-column: 2;
      grid-row: 1 / 3; /* dos filas */
      display: flex;
      flex-direction: column;
      gap: 30px;
    }
    #col-3 {
      grid-column: 3;
      grid-row: 1;
      display: flex;
      flex-direction: column;
      gap: 30px;
    }
    #col-4 {
      grid-column: 3;
      grid-row: 2;
      display: flex;
      flex-direction: column;
      gap: 30px;
    }
    #col-5 {
      display: none; /* no se usa en escritorio */
    }
    /* VERTICAL COLUMNS PARA BLOQUES INDIVIDUALES SIEMPRE */
    .vertical-column {
      display: flex;
      flex-direction: column;
      gap: 30px;
      box-sizing: border-box;
      align-items: stretch;
      min-width: 250px;
      max-width: 100%;
    }
    .column-block {
      background: #FFBD59;
      border-radius: 17px;
      padding: 23px 17px 20px 17px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.09);
      display: flex;
      flex-direction: column;
      align-items: stretch;
      flex-shrink: 0;
      min-height: 100px;
    }
    /* Bloques inferiores crecen para alinear altura */
    .lower-block {
      flex-grow: 1;
    }
    /* Bloques superiores mantienen altura natural */
    .upper-block {
      flex-grow: 0;
    }
    .col-title {
      font-family: 'Montserrat', Arial, sans-serif;
      font-weight: 700;
      text-align: center;
      font-size: 1.21em;
      margin-bottom: 15px;
      color: #114087;
      text-transform: uppercase;
      letter-spacing: 1px;
      user-select: none;
    }
    button.asignatura, button.especial-btn {
      font-size: 1em;
      padding: 14px 13px;
      border: none;
      border-radius: 12px;
      background: #fff;
      margin-bottom: 14px;
      color: #114087;
      font-family: inherit;
      font-weight: 500;
      text-align: left;
      cursor: pointer;
      box-shadow: 0 1.5px 6px rgba(18, 39, 124, 0.08);
      transition: background 0.18s, color 0.18s;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: relative;
      outline: none;
      user-select: none;
    }
    button.asignatura[aria-disabled="true"], button.especial-btn[aria-disabled="true"] {
      cursor: not-allowed;
      background: #d1d1d151;
      color: #5871a0;
      opacity: 0.72;
    }
    button.asignatura.aprobada, button.especial-btn.aprobada {
      background: #114087 !important;
      color: white;
      text-decoration: line-through;
      font-weight: 700;
    }
    .uc-label, .especial-uc-label {
      font-size: 0.93em;
      padding-left: 7px;
      color: #114087b8;
      font-weight: 400;
      opacity: 0.82;
      flex-shrink: 0;
      user-select: none;
    }
    .tooltip {
      visibility: hidden;
      width: 240px;
      background-color: #222c44e2;
      color: #fff;
      text-align: left;
      border-radius: 8px;
      padding: 8px 13px;
      position: absolute;
      z-index: 9;
      left: 50%;
      bottom: 123%;
      transform: translateX(-50%);
      opacity: 0;
      transition: opacity 0.22s;
      font-size: 0.95em;
      font-family: 'Montserrat', Arial, sans-serif;
      pointer-events: none;
      user-select: none;
    }
    button.asignatura[aria-disabled="true"]:hover .tooltip,
    button.especial-btn[aria-disabled="true"]:hover .tooltip {
      visibility: visible;
      opacity: 1;
      pointer-events: auto;
    }
    .info-col {
      background: #fff;
      border-radius: 12px;
      color: #114087;
      font-family: 'Montserrat', Arial, sans-serif;
      font-weight: 500;
      font-size: 1em;
      padding: 16px 11px;
      box-shadow: 0 1.5px 6px #12277c18;
      display: flex;
      flex-direction: column;
      justify-content: center;
      white-space: normal;
      user-select: none;
      line-height: 1.5;
      min-height: 66px;
    }
    .info-col p {
      margin-top: 0;
      margin-bottom: 0;
      line-height: 1.4;
    }
    @media (max-width: 900px) {
      /* En móvil apilamos columnas en orden natural deseado */
      .main-container {
        display: flex;
        flex-direction: column;
        gap: 30px;
        align-items: center;
      }
      #col-1, #col-2, #col-3, #col-4, #col-5 {
        grid-column: auto !important;
        grid-row: auto !important;
        width: 100% !important;
        max-width: 400px;
        display: flex !important;
        flex-direction: column !important;
      }
      #col-5 {
        display: flex !important;
      }
      /* Orden exacto que quieres en móvil */
      #col-1 { order: 1; } /* Primer año + Cuarto año */
      #col-2 { order: 2; } /* Segundo año + Quinto año */
      #col-3 { order: 3; } /* Tercer año */
      #col-4 { order: 4; } /* Casillas especiales */
      #col-5 { order: 5; display: none; } /* podemos usar para extra, oculto */
      /* En móvil, bloque inferiores no se estiran */
      .lower-block {
        flex-grow: 0;
      }
      .upper-block {
        flex-grow: 0;
      }
      #btn-regresa {
        position: static;
        margin: 10px auto 20px auto;
        display: block;
      }
      #logo-header {
        position: fixed;
        top: 12px;
        right: 12px;
        max-width: 120px;
      }
    }
    .footer {
      color: #fff;
      text-align: center;
      font-size: 0.98em;
      margin: 80px 0 20px 0;
      opacity: 0.89;
      max-width: 680px;
      margin-left: auto;
      margin-right: auto;
      line-height: 1.35;
      user-select: none;
    }
  </style>
</head>
<body>
  <button id="btn-regresa" type="button">Regresa a nuestra página</button>

  <img id="logo-header" src="logo en blanco.png" alt="Logo Blanco UCV" />

  <h1 title="Haz Shift + doble clic para limpiar el progreso">
    Malla Curricular - Derecho<br />Universidad Central de Venezuela
  </h1>

  <div class="main-container" id="main-container">
    <!-- Columna 1: Primer y Cuarto año -->
    <div class="vertical-column" id="col-1">
      <div class="column-block upper-block" id="primer-ano-block"></div>
      <div class="column-block lower-block" id="cuarto-ano-block"></div>
    </div>
    <!-- Columna 2: Segundo y Quinto año -->
    <div class="vertical-column" id="col-2">
      <div class="column-block upper-block" id="segundo-ano-block"></div>
      <div class="column-block lower-block" id="quinto-ano-block"></div>
    </div>
    <!-- Columna 3: Tercer año -->
    <div class="vertical-column" id="col-3">
      <div class="column-block upper-block" id="tercer-ano-block"></div>
    </div>
    <!-- Columna 4: Casillas especiales -->
    <div class="vertical-column" id="col-4">
      <div class="column-block lower-block" id="especiales-block"></div>
    </div>
    <!-- Columna 5: Extra (oculto) -->
    <div class="vertical-column" id="col-5" style="display:none;"></div>
  </div>

  <div class="footer">Recuerda que: Unidos Somos Más</div>

  <script>
    // Código JavaScript igual que antes
    const MALLA = [
      { year: "Primer año", materias: [
        { id: "1101", nombre: "Derecho Civil I", uc: 6 },
        { id: "1201", nombre: "Derecho Constitucional", uc: 6 },
        { id: "1501", nombre: "Introducción al Derecho", uc: 6 },
        { id: "1502", nombre: "Derecho Romano I", uc: 6 },
        { id: "1601", nombre: "Economía Política", uc: 6 },
        { id: "1602", nombre: "Sociología Jurídica", uc: 6 }
      ]},
      { year: "Segundo año", materias: [
        { id: "1102", nombre: "Derecho Civil II", uc: 6, deps: ["1101", "1501"] },
        { id: "1202", nombre: "Derecho Administrativo I", uc: 6, deps: ["1201"] },
        { id: "1206", nombre: "Derecho Internacional Público", uc: 6, deps: ["1201"] },
        { id: "1301", nombre: "Derecho Penal I", uc: 6 },
        { id: "1303", nombre: "Criminología", uc: 6 },
        { id: "1503", nombre: "Derecho Romano II", uc: 6, deps: ["1502"] }
      ]},
      { year: "Tercer año", materias: [
        { id: "1103", nombre: "Derecho Civil III", uc: 6, deps: ["1101", "1501"] },
        { id: "1203", nombre: "Derecho Administrativo II", uc: 6, deps: ["1202"] },
        { id: "1205", nombre: "Finanzas Públicas", uc: 6, deps: ["1202", "1601"] },
        { id: "1302", nombre: "Derecho Penal II", uc: 6, deps: ["1301"] },
        { id: "1504", nombre: "Filosofía del Derecho", uc: 6 },
        { id: "1902", nombre: "Práctica Jurídica I", uc: 6, deps: ["1101", "1501"] }
      ]},
      { year: "Cuarto año", materias: [
        { id: "1104", nombre: "Derecho Civil IV", uc: 6, deps: ["1102"] },
        { id: "1106", nombre: "Contratos y Garantías", uc: 6, deps: ["1103"] },
        { id: "1107", nombre: "Derecho Mercantil I", uc: 6, deps: ["1103"] },
        { id: "1109", nombre: "Derecho del trabajo", uc: 6, deps: ["1103"] },
        { id: "1401", nombre: "Derecho Procesal Civil I", uc: 6, deps: ["1102"] },
        { id: "1903", nombre: "Práctica Jurídica II", uc: 6, deps: ["1902"] }
      ]},
      { year: "Quinto año", materias: [
        { id: "1108", nombre: "Derecho Mercantil II", uc: 6, deps: ["1107"] },
        { id: "1110", nombre: "Derecho Internacional Privado", uc: 6, deps: ["1103", "1401"] },
        { id: "1207", nombre: "Derecho Administrativo III", uc: 6, deps: ["1203", "1401"] },
        { id: "1402", nombre: "Derecho Procesal Civil II", uc: 6, deps: ["1401"] },
        { id: "1403", nombre: "Derecho Procesal Penal", uc: 6, deps: ["1302", "1401"] },
        { id: "1904", nombre: "Práctica Jurídica III", uc: 6, deps: ["1401", "1903"] }
      ]}
    ];
    const ESPECIALES = [
      { id: "1905", nombre: "Seminario / Curso de Extensión", uc: 2, necesitaCreditos: 72 },
      { id: "SC", nombre: "Servicio Comunitario", uc: 0, necesitaCreditos: 91 }
    ];
    const STORAGE_KEY = "der_ucv_aprobadas_v2";

    function obtenerAprobadas() {
      try {
        return JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
      } catch {
        return [];
      }
    }
    function guardarAprobadas(aprobadas) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(aprobadas));
    }
    function getMateriaPorId(id) {
      for (let bloque of MALLA) {
        let encontrada = bloque.materias.find(mat => mat.id === id);
        if (encontrada) return encontrada;
      }
      if (id === "SC") return ESPECIALES.find(esp => esp.id === id) || null;
      return null;
    }
    function requisitosNoAprobados(materia, aprobadas) {
      if (!materia.deps) return [];
      return (materia.deps || []).filter(reqId => !aprobadas.includes(reqId));
    }
    function calcCreditosAprobados(aprobadas) {
      let total = 0;
      for (let bloque of MALLA) {
        for (let mat of bloque.materias) {
          if (aprobadas.includes(mat.id) && mat.uc) total += mat.uc;
        }
      }
      for (let esp of ESPECIALES) {
        if (aprobadas.includes(esp.id) && esp.uc) total += esp.uc;
      }
      return total;
    }
    function crearBotonMateria(materia) {
      const aprobadas = obtenerAprobadas();
      let reqsNoAprob = requisitosNoAprobados(materia, aprobadas);
      let bloqueada = reqsNoAprob.length > 0;
      let btn = document.createElement("button");
      btn.className = "asignatura";
      btn.setAttribute("data-id", materia.id);
      btn.tabIndex = 0;
      btn.innerHTML = `<span>${materia.nombre}</span><span class="uc-label">${materia.uc} UC</span>`;
      if (aprobadas.includes(materia.id)) {
        btn.classList.add("aprobada");
        btn.setAttribute("aria-pressed", "true");
      } else {
        btn.setAttribute("aria-pressed", "false");
      }
      if (bloqueada) {
        btn.setAttribute("aria-disabled", "true");
        btn.tabIndex = -1;
        let tooltip = document.createElement("span");
        tooltip.className = "tooltip";
        let textosFaltan = reqsNoAprob.map(id => {
          let mat = getMateriaPorId(id);
          return mat ? mat.nombre : id;
        });
        tooltip.textContent = `Debes aprobar primero: ${textosFaltan.join(", ")}`;
        btn.appendChild(tooltip);
      } else {
        btn.removeAttribute("aria-disabled");
        btn.addEventListener("click", () => toggleAprobada(materia.id));
      }
      return btn;
    }
    function crearBotonEspecial(especial) {
      const aprobadas = obtenerAprobadas();
      const totalCredAprob = calcCreditosAprobados(aprobadas);
      const bloqueada = totalCredAprob < especial.necesitaCreditos;
      const btn = document.createElement("button");
      btn.className = "especial-btn";
      btn.setAttribute("data-id", especial.id);
      const nombreSpan = document.createElement("span");
      nombreSpan.textContent = especial.nombre;
      btn.appendChild(nombreSpan);
      if (especial.uc && especial.uc > 0) {
        const ucSpan = document.createElement("span");
        ucSpan.className = "especial-uc-label";
        ucSpan.textContent = `${especial.uc} UC`;
        btn.appendChild(ucSpan);
      }
      if (aprobadas.includes(especial.id)) {
        btn.classList.add("aprobada");
        btn.setAttribute("aria-pressed", "true");
      } else {
        btn.setAttribute("aria-pressed", "false");
      }
      if (bloqueada) {
        btn.setAttribute("aria-disabled", "true");
        btn.tabIndex = -1;
        const tooltip = document.createElement("span");
        tooltip.className = "tooltip";
        tooltip.textContent = `Debes tener aprobados ${especial.necesitaCreditos} créditos.`;
        btn.appendChild(tooltip);
      } else {
        btn.removeAttribute("aria-disabled");
        btn.addEventListener("click", () => toggleAprobada(especial.id));
      }
      return btn;
    }
    function renderMalla() {
      // Limpiar bloques
      document.getElementById("primer-ano-block").innerHTML = "";
      document.getElementById("segundo-ano-block").innerHTML = "";
      document.getElementById("tercer-ano-block").innerHTML = "";
      document.getElementById("cuarto-ano-block").innerHTML = "";
      document.getElementById("quinto-ano-block").innerHTML = "";
      document.getElementById("especiales-block").innerHTML = "";

      // Primer año
      let c1 = document.getElementById("primer-ano-block");
      c1.insertAdjacentHTML("beforeend", `<div class="col-title">Primer año</div>`);
      MALLA.find((b) => b.year === "Primer año").materias.forEach((m) => {
        c1.appendChild(crearBotonMateria(m));
      });
      // Segundo año
      let c2 = document.getElementById("segundo-ano-block");
      c2.insertAdjacentHTML("beforeend", `<div class="col-title">Segundo año</div>`);
      MALLA.find((b) => b.year === "Segundo año").materias.forEach((m) => {
        c2.appendChild(crearBotonMateria(m));
      });
      // Tercer año
      let c3 = document.getElementById("tercer-ano-block");
      c3.insertAdjacentHTML("beforeend", `<div class="col-title">Tercer año</div>`);
      MALLA.find((b) => b.year === "Tercer año").materias.forEach((m) => {
        c3.appendChild(crearBotonMateria(m));
      });
      // Cuarto año
      let c4 = document.getElementById("cuarto-ano-block");
      c4.insertAdjacentHTML("beforeend", `<div class="col-title">Cuarto año</div>`);
      MALLA.find((b) => b.year === "Cuarto año").materias.forEach((m) => {
        c4.appendChild(crearBotonMateria(m));
      });
      // Quinto año
      let c5 = document.getElementById("quinto-ano-block");
      c5.insertAdjacentHTML("beforeend", `<div class="col-title">Quinto año</div>`);
      MALLA.find((b) => b.year === "Quinto año").materias.forEach((m) => {
        c5.appendChild(crearBotonMateria(m));
      });
      // Casillas especiales
      let c6 = document.getElementById("especiales-block");
      ESPECIALES.forEach((e) => {
        c6.appendChild(crearBotonEspecial(e));
      });
      const infoDiv = document.createElement("div");
      infoDiv.className = "info-col";
      infoDiv.innerHTML =
        `<p>Para cursar <b>Seminario o Curso de Extensión</b>, deben haberse aprobado 72 créditos.</p>` +
        `<p>Para realizar <b>Servicio Comunitario</b>, deben haberse aprobado 91 créditos.</p>`;
      c6.appendChild(infoDiv);
    }

    function toggleAprobada(matId) {
      let aprobadas = obtenerAprobadas();
      if (aprobadas.includes(matId)) {
        aprobadas = aprobadas.filter((id) => id !== matId);
      } else {
        aprobadas.push(matId);
      }
      guardarAprobadas(aprobadas);
      renderMalla();
    }

    window.addEventListener("DOMContentLoaded", renderMalla);

    document.getElementById("btn-regresa").addEventListener("click", () => {
      window.location.href = "https://sites.google.com/view/masestudiantilucv/inicio";
    });

    document.querySelector("h1").ondblclick = (e) => {
      if (e.shiftKey) {
        if (confirm("¿Seguro que deseas borrar todo el progreso guardado?")) {
          localStorage.removeItem(STORAGE_KEY);
          renderMalla();
        }
      }
    };
  </script>
</body>
</html>
